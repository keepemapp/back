= Depolyment using docker

== Networking and set-up

We will have a private network for both of our containers

[code, bash]
----
sudo docker network ls

KEEP_NETW=keepem
KEEP_DATA=$HOME/data
KEEP_DATA_MONGO=$KEEP_DATA/mongo
KEEP_DATA_API=$KEEP_DATA/api


mkdir $KEEP_DATA
mkdir $KEEP_DATA_MONGO
mkdir $KEEP_DATA_API

sudo docker network create $KEEP_NETW
----

== MongoDB

[code,bash]
----
sudo docker pull mongo

sudo docker run \
-p 127.0.0.1:27017:27017 \
--name kpm_mongo \
--net $KEEP_NETW \
-v $KEEP_DATA_MONGO:/data/db \
--restart unless-stopped \
--log-opt max-size=50m --log-opt max-file=1 \
mongo mongod --replSet rs0
----

== API

Create a `.env`  file with:

----
MONGODB_URL=mongodb://kpm_mongo:27017/?replicaSet=rs0
# openssl rand -hex 32
JWT_SECRET_KEY=
DATA_FOLDER=/data
----


[code,bash]
----
sudo docker build -t kpm_api ./
sudo docker stop kpm_api && sudo docker rm kpm_api

sudo docker run \
-p 127.0.0.1:2400:80 \
--name kpm_api \
--net $KEEP_NETW \
--env-file .env \
-v $KEEP_DATA_API:/data \
--restart unless-stopped \
--log-opt max-size=50m --log-opt max-file=1 \
keepem_api
----